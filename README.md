# CX Case Study — Customer Complaints Intelligence Suite

This directory covers three stand-alone assignments covering the full data-to-action pipeline for customer complaint analysis: extraction, AI-assisted analysis, and automated early-warning monitoring. Each folder is represents the a solution to each of the assignments presented in the case study. 

---

## Repository Structure

```
cx-case-study/
├── data/
│   └── sample_complaints.csv        # 80-row synthetic dataset (realistic)
├── out/                             # Generated by running Assignment 1
├── 1_complaints_tool/               # Assignment 1: CLI pipeline
│   ├── main.py                      # Entry point
│   ├── cleaner.py                   # Schema detection + text normalisation
│   ├── theme_extractor.py           # TF-IDF + KMeans clustering
│   ├── reporter.py                  # Output file generation
│   └── tests/test_cleaner.py        # Unit tests
├── 2_ai_data_analyzer/              # Assignment 2: Chat interface
│   ├── main.py                      # Entry point (interactive CLI)
│   ├── router.py                    # Quant vs qual classification + dispatch
│   ├── quant_handler.py             # Counts, trends, breakdowns
│   ├── qual_handler.py              # Retrieval + LLM/rule summarisation
│   └── llm_client.py                # LLM plug-in (OpenAI / Anthropic / no-key)
├── 3_ewp_n8n_design/                # Assignment 3: Early Warning Process
│   ├── ewp_design.md                # Full design document
│   └── ewp_workflow.mmd             # Mermaid workflow diagram
├── slides/
│   └── index.html                   # Self-contained HTML presentation (15 slides)
├── requirements.txt
└── README.md
```

---

## Quick Start

### 1. Install dependencies

```bash
pip install -r requirements.txt
```

Python 3.9+ required

---

### 2. Assignment 1 — Complaints Pipeline

```bash
cd 1_complaints_tool
python main.py --input ../data/sample_complaints.csv --output-dir ../out
```

With options:
```bash
python main.py \
  --input ../data/sample_complaints.csv \
  --output-dir ../out \
  --n-themes 6 \
  --verbose
```

**Output files written to `out/`:**

| File | Description |
|------|-------------|
| `cleaned_complaints.csv` | Deduplicated, normalised rows + `text_clean` + `theme_id` |
| `themes.csv` | theme_id, label, count, top_keywords, example_texts |
| `summary.md` | Markdown report: stats, channel/product tables, theme details |
| `metrics.json` | Machine-readable: cleaning metrics + theme counts |

---

### 3. Assignment 2 — AI + Data Analyzer

Assignment 2 loads Assignment 1 outputs automatically. If `out/` is missing, it runs Assignment 1 first.

```bash
cd 2_ai_data_analyzer
python main.py
```

Or point to specific files:
```bash
python main.py --cleaned ../out/cleaned_complaints.csv --themes ../out/themes.csv
```

**LLM modes:**

| Mode | Activation | Behaviour |
|------|-----------|-----------|
| NO-KEY (default) | No env var needed | Rule-based answers; cites retrieved examples |
| OpenAI GPT | `export OPENAI_API_KEY="sk-..."` | Uses gpt-3.5-turbo for qual summaries |
| Anthropic Claude | `export ANTHROPIC_API_KEY="sk-ant-..."` | Uses claude-3-haiku for qual summaries |

- These models were chosen for their cost efficiency and ability to deliver fast, reliable insights at scale for customer experience operations.

**12 Example Questions:**

| # | Question | Type | Expected Behaviour |
|---|----------|------|--------------------|
| 1 | How many complaints are there in total? | Quant | Row count with top-theme callout |
| 2 | What are the top complaint themes? | Quant | Ranked list: all 5 themes with counts and % |
| 3 | How many complaints came through the phone channel? | Quant | Channel breakdown table |
| 4 | Show me the monthly complaint trend | Quant | Month-by-month counts (Jan–Mar 2024) |
| 5 | What percentage of complaints are high severity? | Quant | Severity distribution with % |
| 6 | Which product category has the most complaints? | Quant | Product breakdown sorted by volume |
| 7 | Why are customers frustrated with the mobile app? | Qual | Summary of app complaints + 2 examples |
| 8 | Summarise complaints about billing and fees | Qual | Analysis + one actionable recommendation |
| 9 | What are customers saying about customer service? | Qual | Identifies wait times, rude agents, no callbacks |
| 10 | Describe the main issues with account access | Qual | Locked accounts, 2FA failures, password resets |
| 11 | Show me examples of transaction problems | Qual | Top 3 retrieved examples from transaction theme |
| 12 | What is wrong with the loan application process? | Qual | Summarises mortgage/loan delay complaints |

Chat commands: `:help` `:examples` `:mode` `:quit`

---

### 4. Assignment 3 — EWP Design

Document-only deliverable — no server required:

```bash
cat 3_ewp_n8n_design/ewp_design.md    # full design document
cat 3_ewp_n8n_design/ewp_workflow.mmd # paste into mermaid.live to render
```

Covers: 6 signal definitions · σ-based thresholds · HITL design · example JSON payload · audit log schema · risk/mitigation table.

---

### 5. Open the Slides

```bash
open slides/index.html        # macOS
xdg-open slides/index.html    # Linux
start slides/index.html       # Windows
```

Zero external dependencies. Navigate with **← →** arrow keys or on-screen buttons.
15 slides: title → overview → A1 pipeline/cleaning/themes/outputs → A2 architecture/router/Q&A → A3 EWP/thresholds/workflow/payload → risks → next steps.

---

### 6. Run Tests

```bash
pytest 1_complaints_tool/tests/ -v
```

---

## Assumptions

1. **Schema auto-detection** — text column found by name match (`complaint_text`, `description`, `message`, etc.) then falls back to longest-average-length string column.
2. **Determinism** — all KMeans runs use `random_state=42`; results are identical on repeated runs of the same input.
3. **NO-KEY MODE** — rule-based qual answers wrap real retrieved examples in a template; no hallucination. Swap in any LLM by editing `llm_client.py`.
4. **TF-IDF vocabulary** — `max_features=3000` with bigrams. For >50k rows, increase to 10k and use `MiniBatchKMeans`.
5. **EWP baseline cold-start** — 28-day rolling baseline requires ≥ 4 weeks of history; for first run seed manually.

---

## Dependencies

| Package | Version | Purpose |
|---------|---------|---------|
| pandas | 2.1.4 | Data loading, cleaning, aggregation |
| numpy | 1.26.2 | Numerical operations |
| scikit-learn | 1.3.2 | TF-IDF + KMeans |
| pytest | 7.4.4 | Unit tests |

Optional (uncomment in `requirements.txt`): `openai`, `anthropic`, `streamlit`
