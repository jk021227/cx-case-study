---
title: EWP n8n Workflow — Early Warning Process
---
flowchart TD
    A(["Schedule Trigger<br/>Every 15 minutes"]) --> B

    B["Postgres Node<br/>Fetch complaint counts<br/>for last 15 min window"] --> C

    C["Function Node<br/>Compute signals:<br/>• SIG-01 Volume<br/>• SIG-02 Theme spike<br/>• SIG-03 Severity<br/>• SIG-04 Channel surge<br/>• SIG-05 Keywords<br/>• SIG-06 No-data"] --> D

    D{"Any threshold<br/>crossed?"}

    D -- No breach --> E["Postgres Node<br/>Log execution<br/>to ewp_audit_log"]
    E --> Z(["End cycle"])

    D -- Breach detected --> F["Function Node<br/>Determine level<br/>INFO / WARN / CRITICAL<br/>Build alert payload<br/>Anonymise PII"]

    F -- INFO --> G["HTTP Request<br/>Update monitoring<br/>dashboard via API"]
    G --> E

    F -- WARN or CRITICAL --> H["Function Node<br/>Select notification<br/>channels by level"]

    H --> I["Slack Node<br/>Post alert card to<br/>#cx-alerts or<br/>#cx-critical"]
    H --> J["Email Node<br/>Send HTML alert<br/>to on-call list"]
    H --> K_cond{"Level is<br/>CRITICAL?"}
    K_cond -- Yes --> K["PagerDuty Node<br/>Create incident<br/>for on-call engineer"]
    K_cond -- No --> L

    I --> L["⏳ Wait Node<br/>Await HITL webhook<br/>WARN: 60 min timeout<br/>CRITICAL: 15 min timeout"]
    J --> L
    K --> L

    L -- Webhook received --> M{"Action<br/>from human?"}
    L -- Timeout expired --> N["Function Node<br/>Build escalation<br/>payload"]

    M -- Acknowledged /<br/>Investigating --> O["Postgres Node<br/>Log HITL ack<br/>actor + timestamp"]
    M -- False Positive --> P["Postgres Node<br/>Log false positive<br/>Update threshold model"]
    M -- Resolved --> Q["Slack Node<br/>Post resolution<br/>message to channel"]

    N --> R["Slack Node<br/>Escalate — mention<br/>next-tier responders"]
    N --> S["Email Node<br/>Send escalation<br/>to director level"]
    N --> T["Postgres Node<br/>Log escalation<br/>event + timestamp"]

    O --> Z
    P --> Z
    Q --> Z
    R --> Z
    S --> Z
    T --> Z

    style A fill:#6366F1,color:#fff,stroke:#4F46E5
    style Z fill:#10B981,color:#fff,stroke:#059669
    style D fill:#F59E0B,color:#fff,stroke:#D97706
    style M fill:#F59E0B,color:#fff,stroke:#D97706
    style K_cond fill:#F59E0B,color:#fff,stroke:#D97706
    style F fill:#3B82F6,color:#fff,stroke:#2563EB
    style N fill:#EF4444,color:#fff,stroke:#DC2626